LLiberies necessaries:
```{r}
library('VIM')        # Util per aplicar KNN
library('dplyr')      # Selects
library('missForest') # Valors nulls
library('psych')      # corr plot
```
Integraci√≥ i selecci√≥ de dades:
```{r}
data_heart <- read.csv("../csv/heart.csv")

num_fil <- dim(data_heart)[1]
num_col <- dim(data_heart)[2]

print("El data set te una mida:")
sprintf("Files: %d", num_fil)
sprintf("Columnes: %d", num_col)
```
Neteja de dades:
Les dades contenen zeros o elements buits:
```{r}

# Calculem si tenim dades nulles
colSums(is.na(data_heart))

print("No hi ha valors nulls")

# En cas de rebre noves dades, aquestes podrien contenir valors nulls o elements buits.

# Per tant, procedim a "inventar" valors nulls per tal de fer un tractament de dades que en un futur ens permeti acceptar i tractar dades no completes.

# Utilitzarem el metode KNN per suplir aquest valors i no "descartar" les dades

# Enlla√ß de referencia: https://rpubs.com/harshaash/KNN_imputation
# Enlla√ß dos: https://www.analyticsvidhya.com/blog/2016/03/tutorial-powerful-packages-imputing-missing-values/

# Introduim valors aleatoris: https://search.r-project.org/CRAN/refmans/missForest/html/prodNA.html

data_nulls <- data_heart

data_nulls <- prodNA(data_nulls, noNA = 0.01) #1% de valors nulls

print("Data amb valors nulls")
colSums(is.na(data_nulls))

# Realitzem els calculs de KNN
data_knn_filled <- kNN(data_nulls, variable = names(data_nulls), k = 10)
colSums(is.na(data_knn_filled))

# Observem que data_knn_filled augmenta les variables a 28.
# Ens quedem amb les dades utils, les que coincideixen amb el dataframe inicial
data_knn_filtred <- subset(data_knn_filled, select = names(data_nulls))
summary(data_knn_filtred)
```
Identifica i gestiona valors extrems:

Per trobar els valors extrems, hem considerat que quan un valor es troba allunyat 3 desviacions est√†ndard respecte a la mitjana del conjunt √©s un outlier. Per trobar-los hem representant les dades en boxplots. Hem realitzat aquesta comprovaci√≥ a les variables numeriques seguent:

```{r}
data_numerical <- as.data.frame(data_heart %>%
                  select("trtbps","thalachh","chol","oldpeak", "age"))
```

BoxPlot:
```{r}
boxplot <- boxplot(data_numerical)

```
Com es pot veure, les columnes oldpeak, chol, thalachh i trtbps tenen possibles outliers.
Per eliminar-los, he creat la seg√ºents funcions per seleccionar aquells valor 3 desviacions standars allunyats:

```{r}
outliers = function(x) {

  standardD <- sd(x)
  mitjana <- mean(x)

 #Upper Range
 upper_limit = mitjana + 3*standardD
 #Lower Range
 lower_limit = mitjana - 3*standardD

 x > upper_limit | x < lower_limit
}
# remove the outliers
elimina_outliers <- function(df_outliers, cols = names(df_outliers)) {
  for (col in cols) {
    df_outliers<- df_outliers[!outliers(df_outliers[[col]]),]
  }
  df_outliers
}
```
Apliquem aquesta funci√≥ i mostrem els nous boxplots, a on es pot veure la disminuci√≥ de outliers:

```{r}
data_heart<-elimina_outliers(data_heart,c("trtbps","oldpeak" ,"thalachh", "chol"))
data_numerical <- as.data.frame(data_heart %>%
                  select("trtbps","thalachh","chol","oldpeak", "age"))
boxplot <- boxplot(data_numerical)

```
An√†lisi de les dades
Selecci√≥ de dades:
```{r}
# Obtenim les dades estad√≠stiques b√†siques del dataset
summary(data_heart)

# Mostrem els primers 5 valors
head(data_heart, n = 5)

# Podem visualitzar al dataframe el mateix que ens explicava el dataset, que hi ha dades amb valors 0,1,2... per tant son variables categoriques que no estan catalogades com a tal.
# Enlla√ß: https://sparkbyexamples.com/r-programming/r-select-function-from-dplyr/

# Analisis de correlacio, ø quines dades tenen mes relacio entre elles i el output?

corr_df <- cor(data_heart)

corPlot(corr_df, main = "Matriu de correlaciÛ")

# Observacions Correlacio
#
#
#
#
# blablabla

output_distr <- data_heart$output
hist(output_distr)


```

```{r}

# Reestablim les dades ara sense els outliers.
data_numerical <- as.data.frame(data_heart %>%
                  select("trtbps","thalachh","chol","oldpeak", "age"))

# Obtenim les variables categoriques i les transformem al tipus necesari
# Link : https://gist.github.com/ramhiser/93fe37be439c480dc26c4bed8aab03dd

data_categorical <- as.data.frame(data_heart %>%
                  select("sex","cp","fbs","restecg", "exng", "slp", "caa", "thall", "output"))

data_categorical <- data_categorical %>% mutate_if(is.numeric, as.factor)
# Dades categoriques:

data_categorical

```

Comprovaci√≥ de la normalitat i homogene√Øtat de la vari√†ncia:

```{r}

```

Proves estad√≠stiques:
```{r}

```


